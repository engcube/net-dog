# 🚀 网络流量监控工具

一款专为macOS设计的智能网络流量监控工具，实时显示设备网络活动，智能识别热门网站和服务。

## ✨ 核心特性

### 🎯 智能监控
- **设备自动识别** - 智能聚合VPN和直连设备流量
- **网站智能分类** - 基于V2Ray规则自动识别数千个网站
- **真实流量分析** - 基于网卡实际数据，无人工权重
- **动态适应网络** - 自动检测网络配置，支持任意网段

### 🌐 强大识别能力  
- **完整网站数据库** - 集成v2ray-rules-dat，覆盖全球主流服务
- **三层解析架构** - GeoSite数据库 + IP范围匹配 + DNS缓存
- **实时更新** - 自动下载最新网站分类数据
- **智能缓存** - 1小时DNS缓存，显著提升性能

### 🖥️ 现代化界面
- **专业终端UI** - Rich库打造的现代化界面
- **实时数据** - 每3秒更新，流畅展示网络状态  
- **分页浏览** - Top50网站支持键盘翻页控制
- **流量图表** - 60秒时间线可视化

## 🚀 快速开始

### 一键安装
```bash
# 克隆项目
git clone https://github.com/user/net-dog.git
cd net-dog

# 安装依赖
./install.sh

# 启动监控
./run.sh
```

### 手动安装
```bash
# 创建虚拟环境
python3 -m venv venv
source venv/bin/activate

# 安装依赖
pip install rich

# 运行程序
python3 network_monitor.py
```

## 📊 界面说明

程序采用统一表格展示所有信息：

| 设备/网站 | 地区 | 上行 | 下行 | 连接 |
|---------|------|------|------|------|
| Clash设备 | - | 1.2MB | 5.4MB | 12 |
| ├─ YouTube | 海外 | 234KB | 2.1MB | 3 |
| ├─ Google | 海外 | 156KB | 892KB | 2 |
| 直连设备 | - | 456KB | 1.8MB | 8 |
| ├─ 淘宝 | 中国 | 89KB | 445KB | 2 |

## ⌨️ 键盘操作

- **N / 空格** - 下一页
- **P / B** - 上一页  
- **R** - 重置到第一页
- **Ctrl+C** - 退出程序

## 🔧 技术架构

### 核心算法
- **数据驱动分配** - 基于实际连接活跃度分配流量权重
- **网卡真实比例** - 直接使用网卡上下行数据，无需人工配置
- **IP多样性加权** - CDN服务自动获得合理流量权重
- **确定性算法** - 无随机化，结果可预测和重现

### 文件结构
```
net-dog/
├── network_monitor.py       # 主程序
├── domain_resolver.py       # 域名解析引擎  
├── geosite_loader.py        # V2Ray数据加载器
├── smart_ip_identifier.py   # IP智能识别
├── v2ray_dat_parser.py      # 数据解析器
├── install.sh              # 安装脚本
├── run.sh                  # 启动脚本
└── data/                   # 数据目录
```

## 🌍 网络适配

### 自动检测
- **网段识别** - 自动检测本地网络配置
- **VPN适配** - 支持各种VPN和代理环境
- **接口监控** - 监控所有活跃网络接口
- **跨机器兼容** - 同一份代码适用不同网络环境

### 支持环境
- ✅ macOS 10.14+ 
- ✅ 家用路由器 (192.168.x.x / 10.x.x.x)
- ✅ Clash / V2Ray / Surge等代理工具
- ✅ 企业网络环境
- ✅ 多网卡配置

## ⚠️ 注意事项

- **权限需求** - 需要管理员权限获取完整网络统计
- **Python版本** - 需要Python 3.7+
- **网络要求** - 首次运行需联网下载网站数据库
- **更新频率** - 数据每3秒更新，网站数据库每24小时更新

## 🔄 更新日志

### 最新版本
- ✅ 移除人工权重配置，改为数据驱动分配
- ✅ 使用网卡真实上下行比例，不再硬编码75%/25%
- ✅ 移除随机化因子，算法更加确定和可预测
- ✅ 简化界面，统一表格展示所有信息
- ✅ 支持网络配置自动检测，提升跨机器兼容性

---

*macOS智能网络流量监控解决方案*