# 🚀 网络流量监控工具 V3

一个专为Mac设计的高级网络流量监控工具，支持实时显示局域网设备网络活动，智能识别YouTube等热门网站。

## ✨ 核心功能

- 🖥️ **智能设备识别** - 自动聚合VPN和本机多端口流量
- 🌐 **完整网站数据库** - 集成v2ray-rules-dat，支持数千个网站识别
- 📄 **翻页显示** - 支持Top50网站翻页浏览（N/P/R键控制）
- 📈 **实时流量图表** - 60秒流量时间线可视化
- ⚡ **三层解析架构** - GeoSite数据库+IP范围+DNS缓存，极速识别
- 🎨 **现代终端UI** - Rich库打造的专业级界面
- 🔄 **自动数据更新** - 每日自动更新v2ray-rules-dat数据文件

## 🛠 安装使用

### 快速开始
```bash
# 1. 安装依赖
./install.sh

# 2. 启动监控
./run.sh
```

### 手动安装
```bash
# 1. 创建虚拟环境
python3 -m venv venv

# 2. 安装依赖
source venv/bin/activate
pip install rich

# 3. 运行工具
python3 network_monitor_v3.py
```

## 🖼 界面布局

- **📋 网络概况** (左上) - 活跃设备数、累计流量、DNS缓存状态
- **🌐 网站访问统计** (左下) - Top50网站翻页显示，支持N/P/R键控制
- **🖥️ 设备流量统计** (右上) - VPN设备、本机设备自动聚合
- **📈 流量时间线** (右下) - 最近60秒流量可视化图表

## 🔧 核心技术

### V2Ray GeoSite集成 (`geosite_loader.py`)
- **完整数据库**: 自动下载v2ray-rules-dat最新数据文件
- **智能缓存**: 24小时更新周期，1小时内避免重复下载
- **数千网站支持**: 覆盖全球主流网站和服务
- **子域名匹配**: 支持mail.google.com → google自动识别

### 三层域名解析 (`domain_resolver.py`)
- **L1 GeoSite查询**: 优先使用完整网站数据库
- **L2 IP范围匹配**: 预置主要网站IP段快速识别  
- **L3 DNS反向查询**: 0.5秒超时DNS兜底查询
- **智能缓存**: 1小时TTL缓存，12x性能提升

### 智能网站分类 (`_categorize_domain`)
- **优先级策略**: GeoSite数据库 → IP范围识别 → DNS查询 → 兜底
- **地理位置**: 自动识别中国/海外网站位置
- **分类标准化**: 统一的网站分类显示名称

### 设备流量聚合
- **VPN设备**: 28.0.0.x网段自动识别为VPN设备
- **本机设备**: 192.168.31.x多端口聚合为单一本机设备
- **流量分配**: 按连接数比例分配接口流量增量

## 📋 键盘控制

在网站访问统计面板：
- **N 或 空格**: 下一页
- **P 或 B**: 上一页  
- **R**: 重置到第一页
- **Ctrl+C**: 退出程序

## 🔧 技术特性

核心功能特点：
- **智能识别**: 支持数千个网站和服务的自动识别
- **高性能**: DNS缓存机制实现快速域名解析  
- **完整监控**: VPN和直连流量的全面覆盖
- **用户友好**: 直观的键盘操作和分页浏览

## 📁 项目结构

```
net-dog/
├── network_monitor_v3.py    # 主监控程序
├── domain_resolver.py       # 增强域名解析器
├── geosite_loader.py        # V2Ray GeoSite数据加载器
├── smart_ip_identifier.py   # 智能IP识别器
├── v2ray_dat_parser.py      # V2Ray数据解析器
├── install.sh              # 安装脚本
├── run.sh                  # 启动脚本
├── README.md               # 项目文档
└── data/                   # 数据文件目录
    ├── geosite.dat         # 网站分类数据
    └── geoip.dat           # IP地理位置数据
```

## ⚠️ 使用说明

- 需要管理员权限获取完整网络统计
- 自动检测本地网段（192.168.31.0/24）
- 支持VPN环境下的流量监控
- 实时数据每3秒更新一次

---

*macOS网络流量监控的完整解决方案*